<!DOCTYPE html>
<html>
    <head>
      <!-- Utilizar la librería para poder utilizar el protocolo MQTT-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mqtt/4.2.6/mqtt.js"></script>
        <link rel="stylesheet" href="styles.css">
<script>

    //Conectarse a l broker mosquito
    var client = mqtt.connect("ws://test.mosquitto.org:8080/mqtt");

//subscribirse al canal arg, mi canal    
function EventoConectar() {
  console.log("Conectado a MQTT");
  client.subscribe("mzmd/#", function (err) {
    if (!err) {
      //enviar el mensaje al broker a mi topic mzmd subtema acciones el mensaje de apagar
      //para que inicie con el led apagado
      client.publish("mzmd/accionesMez", "apagar");
    }
  });
}


//función que recibe los mensajes del broker que son del topic de mi interés
function EventoMensaje(topic, message) {
  if (topic == "mzmd/accionesMez") {
    console.log("Acción " + message.toString());
  }
  console.log(topic + " - " + message.toString());
  // client.end()
}

//Conectares al broker
client.on("connect", EventoConectar);

//Ponerse a la escucha de la llegada de mensajes del broker
client.on("message", EventoMensaje);

</script>

<meta name="viewport" content="width=device-width, initial-scale=1">

</head>
<body>
<script>

 
//función que cambia de prendido a apagado o viceversa
function mifuncion(direccion)
{
  console.log(direccion);

  switch(direccion){

    case 'avanzar':
      client.publish("mzmd/accionesMez", "avanzar");
      document.getElementById("estado").innerHTML="...Avanzando...";
      break;

    case 'retroceder':
      client.publish("mzmd/accionesMez", "retroceder");
      document.getElementById("estado").innerHTML="...Retrocediendo...";
      break;

    case 'izquierda':
      client.publish("mzmd/accionesMez", "izquierda");
      document.getElementById("estado").innerHTML="...Girando a la izquierda...";
      break;

    case 'derecha':
      client.publish("mzmd/accionesMez", "derecha");
      document.getElementById("estado").innerHTML="...Girando a la derecha...";
      break;

    case 'detenerse':
      client.publish("mzmd/accionesMez", "detenerse");
      document.getElementById("estado").innerHTML="...DETENIDO...";
      break;

    default:
      break;
  }
}

</script>

<!--Mostrar la interfaz principal de mi aplicación Web-->
<div class="title">
  <h2>Mover llantas </h2>
  <h2>con la placa NodeMCU 8266</h2>
</div>
  
<div class="canvaDiv">
    <button onclick="mifuncion('avanzar')">AVANZAR</button>
    <button onclick="mifuncion('retroceder')">RETROCEDER</button>
    <button onclick="mifuncion('izquierda')">IZQUIERDA</button>
    <button onclick="mifuncion('derecha')">DERECHA</button>
    <button onclick="mifuncion('detenerse')">DETENERSE</button>
    <div class="console">
      <h1 id="estado"></h1>
    </div>
  </div>

</body>
</html>